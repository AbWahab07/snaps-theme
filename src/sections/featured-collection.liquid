{%- assign collection = collections[section.settings.collection] -%}

<div 
  data-section-id="{{ section.id }}" 
  data-section-type="featured-collection-section" 
  class="featured-collection-container">
  <div class="collection-metadata">
    <div class="background"></div>
    <div class="collection-anchor-image"
        style="background: url({{section.settings.anchor_image | img_url: '4472x'}}) no-repeat; 
               background-position: bottom right;">
      <div class="collection-label">{{section.settings.collection_heading}}</div>
      <div class="collection-name">{{collection.title}} Series</div>
      <div class="collection-description">{{collection.description}}</div>
      <div class="call-to-action-container">
        <a href="{{collection.url}}">
          <div class="shop-now-button">
            SHOP NOW
          </div>
        </a>
      </div>
    </div>
  </div>
  <div class="collection-products">
    <div class="product-showcase">
      {% for product in collection.products limit: 4 %}
      {%- assign product_quantity = product.variants[0].inventory_quantity -%}
      <div class="product-block{% if product.tags contains 'Obscene' %} obscene{% endif %}" data-product-id={{product.id}}>
        <div class="product-topbar">
          {% if product_quantity == 0 %}
            <div class="quantity-tag sold-out">SOLD OUT</div>
          {% elsif product_quantity > 3 %}
            <div class="quantity-tag new">NEW</div>
          {% else %}
            <div class="quantity-tag few-left">FEW LEFT</div>
          {% endif %}
        </div>
        <div class="product-image">
          <img src="{{product.featured_image | img_url: '800x' }}" />
        </div>
        <div class="product-bottombar">
          <div class="product-data">
            <div class="product-name">{{product.title}}</div>
            <div class="product-sku">{{product.variants[0].sku}}</div>
          </div>
          <div class="product-action">
            <div class="product-price">{{product.price | money_without_trailing_zeros | remove: ',' }}</div>
            <div class="add-to-cart-button"></div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="view-series">
      <a href="{{collection.url}}">View Series</a>
    </div>
  </div>
</div>
{% schema %}
  {
    "name": "Featured collection",
    "settings": [
      {
        "type": "text",
        "id": "collection_heading",
        "label": "Collection Heading"
      },
      {
        "id": "collection",
        "type": "collection",
        "label": "Collection"
      },
      {
        "id": "anchor_image",
        "type": "image_picker",
        "label": "Anchor Image"
      }
    ],
    "presets": [
      {
        "name": "Featured collection",
        "category": "Collection"
      }
    ]
  }
{% endschema %}